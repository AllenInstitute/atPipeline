ARG BASE_TAG
FROM atpipeline/clang-base-image:${BASE_TAG}

##Fetch dsl and atExplorer repositories
#RUN mkdir /libs && mkdir /libs/dsl \
#    && git clone https://github.com/TotteKarlsson/dsl.git /libs/dsl \
#    && git -C /libs/dsl checkout develop \
#    && git -C /libs/dsl pull \
#    && git -C libs/dsl submodule init \
#    && git -C libs/dsl submodule update

###Fetch dsl and atExplorer repositories (need to be made public)
##RUN mkdir /libs/atExplorer \
##    && git clone https://github.com/AllenInstitute/ATExplorer.git /libs/atExplorer \
##    && git -C /libs/atExplorer checkout develop \
##    && git -C /libs/atExplorer pull

#For development, mount the /libs and /build folders to see whats going on
RUN mkdir /libs
COPY ./third-party-libs /libs
   
#Build libs and apps
RUN mkdir /build 
COPY build-thirdparty-libs.bash /build
WORKDIR /build
RUN bash build-thirdparty-libs.bash

CMD [ "/bin/bash" ]
